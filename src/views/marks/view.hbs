{{>header}}


{{>navbar}}

{{>sidebar}}

<!-- Content Wrapper. Contains page content -->
<div class="content-wrapper">
    <div class="container-full">
        <!-- Content Header (Page header) -->
        <div class="content-header">
            <div class="d-flex align-items-center">
                <div class="me-auto">
                    <h3 class="page-title">تفصیل</h3>
                </div>

            </div>
        </div>

        <!-- Main content -->
        {{#each marks}}
        <section class="invoice printableArea">
            <div class="row">
                <div class="col-12">
                    <div class="bb-1 clearFix">
                        <div class="text-end pb-15">
                            <button class="btn btn-success" type="button"> <span><i class="fa fa-print"></i>
                                    Save</span>
                            </button>
                            <button id="print2" class="btn btn-warning" type="button"> <span><i class="fa fa-print"></i>
                                    Print</span> </button>
                        </div>
                    </div>
                </div>
                <div class="col-12">
                    <div class="page-header">
                        <h2 class="d-inline"><span class="fs-30"><b>سیشن:</b>{{@key}}</span></h2>
                        <div class="pull-right text-end">
                            <h3>22 April 2018</h3>
                        </div>
                    </div>
                </div>
                <!-- /.col -->
            </div>
            <div class="row invoice-info">
                <!-- /.col -->
                <div class="col-sm-12 invoice-col mb-15">
                    <div class="invoice-details row no-margin">
                        <div class="col-md-6 col-lg-3"><b>Invoice </b>{{student.rollNumber}}</div>
                        <div class="col-md-6 col-lg-3"><b>Order ID:</b> FC12548</div>
                        <div class="col-md-6 col-lg-3"><b>Payment Due:</b> 14/08/2018</div>
                        <div class="col-md-6 col-lg-3"><b>Account:</b> 00215487541296</div>
                    </div>
                </div>
                <!-- /.col -->
            </div>
            <div class="row">
                <div class="col-12 table-responsive">
                    <table class="table table-bordered">
                        <tbody>
                            <tr>
                                <th>#</th>
                                <th>مضمون</th>
                                <th>امتحان</th>
                                <th class="text-start">حاصل کردہ نمبر</th>
                                <th class="text-start">کل نمبر</th>
                            </tr>
                            {{#each this}}
                            <tr>
                                <td>{{increment @index}}</td>
                                <td>{{this.subject.name}}</td>
                                <td>{{this.term}}</td>
                                <td class="text-start">{{this.marksObtained}}</td>
                                <td class="text-start">{{this.subject.totalMarks}}</td>
                            </tr>
                            {{/each}}
                        </tbody>
                    </table>
                </div>
                <!-- /.col -->
            </div>
            <div class="row">
                <div class="col-12 text-start">
                    {{!-- <p class="lead"><b>نتائج تاریخ </b><span class="text-danger pe-1"> 14/08/2018 </span></p> --}}

                    <div>
                        <p>Sub - Total amount : 00</p>
                        <p>Tax (18%) : 0%</p>
                        <p>Shipping : 00</p>
                    </div>
                    <div class="total-payment">
                        <h3><b>کل نمبر :</b> 000</h3>
                    </div>

                </div>
                <!-- /.col -->
            </div>
        </section>

        {{!-- <div class="col-lg-6 col-12">
            <div class="box">
                <div class="box-header with-border">
                    <h4 class="box-title">سیشن: {{@key}}</h4>
                </div>
                <!-- /.box-header -->
                <div class="box-body">
                    <div class="table-responsive">
                        <table id="example"
                            class="table table-bordered table-hover display nowrap margin-top-10 w-p100">
                            <thead>
                                <tr>
                                    <th>مضمون</th>
                                    <th>امتحان</th>
                                    <th>حاصل کردہ نمبر</th>
                                    <th>کل نمبر</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{#each this}}
                                <tr {{#ifCond this.marksObtained "<=" this.subject.passingMarks}}class="bg-danger-light"
                                    {{/ifCond}}>
                                    <td>{{this.subject.name}}</td>
                                    <td>{{this.term}}</td>
                                    <td>{{this.marksObtained}}</td>
                                    <td>{{this.subject.totalMarks}}</td>
                                </tr>
                                {{/each}}
                            </tbody>
                        </table>

                    </div>
                </div>
                <!-- /.box-body -->
            </div>
            <!-- /.box -->
        </div> --}}
        {{/each}}
    </div>
    <!-- /.row -->

    </section>
    <!-- /.content -->

    {{>footer}}
    <script src="/vendor_components/formatter/formatter.js"></script>
    <script src="/vendor_components/formatter/jquery.formatter.js"></script>
    <script src="/js/pages/students.js"></script>
    <script src="/js/pages/invoice.js"></script>
    <script src="/vendor_plugins/JqueryPrintArea/demo/jquery.PrintArea.js"></script>
    <script>
        $(document).ready(function () {

            let filterSubmit = $('#filter-submit');
            filterSubmit.on('click', () => {
                const studentId = $('#studentId').val()
                const session = $('#session').val()
                const term = $('#term').val()
                $.ajax({
                    url: '/marks/student-marks',
                    method: 'POST',
                    dataType: 'json',
                    contentType: 'application/json',
                    processData: false,
                    data: JSON.stringify({ studentId, session, term }),
                    success: ({ body }) => {
                        let marks = body;
                        //empty the result for adding the marks elements
                        $('#result').empty()
                        console.log(marks)
                        if (marks.length > 0) {
                            $('button[type=submit]').attr("disabled", false);
                            marks.forEach(mark => {
                                let element = createInputElement(mark);
                                $('#result').append(element);
                            })
                        } else {
                            $('button[type=submit]').attr("disabled", true);
                            $('#result').html(`<h4 class="text-center text-danger py-2">کوئی نمبر نہیں ملے!</h4>`);
                        }
                    },
                    error: (err) => {
                        console.error(err);
                        alert(err?.message)
                    }
                })
            })
        })
        function createInputElement(data) {
            let subject = data.subject;

            // Create a div element with class "col-md-6"
            var divCol = document.createElement('div');
            divCol.className = 'col-md-6';

            // Create a div element with class "form-group"
            var divFormGroup = document.createElement('div');
            divFormGroup.className = 'form-group';

            // Create a label element with class "form-label" and text content "Name"
            var labelName = document.createElement('label');
            labelName.className = 'form-label';
            labelName.textContent = subject.name;

            // Create an input element with type "number", min="0", class "form-control", and required attribute
            var inputName = document.createElement('input');
            inputName.type = 'number';
            inputName.min = '0';
            inputName.max = subject.totalMarks;
            inputName.name = `marksObtained[${subject._id}]`
            inputName.value = data.marksObtained;
            inputName.className = 'form-control';
            inputName.required = true;

            // Append the label and input elements to the "form-group" div
            divFormGroup.appendChild(labelName);
            divFormGroup.appendChild(inputName);

            // Append the "form-group" div to the "col-md-6" div
            divCol.appendChild(divFormGroup);
            return divCol;
        }
    </script>